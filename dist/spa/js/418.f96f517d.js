"use strict";(globalThis["webpackChunkcom_smart_meter_reading"]=globalThis["webpackChunkcom_smart_meter_reading"]||[]).push([[418],{3418:(e,a,s)=>{s.r(a),s.d(a,{default:()=>K});var l=s(1758),o=s(8790),t=s(9104),n=s(8734),i=s(3394),r=s(4907),c=s(3009),d=s(4685),u=s(660);const g={class:"login-container"},v={class:"logo-section"},m={class:"logo-icon"},p={class:"login-form-container"},k={key:0,class:"error-banner","data-test":"login-error"},L={class:"form-field"},f={class:"form-field"},b={class:"password-field"},y=["type"],h=["disabled"],w=["disabled"],_={class:"forgot-password"},D={class:"create-account"},U={__name:"LoginPage",setup(e){const a=(0,i.rd)(),s=(0,r.A)(),U=(0,c.useUserStore)(),C=(0,n.KR)(""),P=(0,n.KR)(""),A=(0,n.KR)(!1),E=(0,n.KR)(!1),I=(0,n.KR)(!1),R=(0,n.KR)(""),K=(0,l.EW)(()=>!!U.getUser),S=(0,l.EW)(()=>!!U.getToken),W=e=>{const a=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.test(e)};(0,l.sV)(()=>{K.value&&S.value?a.replace({name:"account-select"}):K.value&&!S.value&&U.signOut()});const N=async()=>{if(R.value="",C.value&&P.value)if(W(C.value)){E.value=!0;try{const e=await(0,u.userLogin)({email:C.value,password:P.value});console.log("[Login] Login response:",e);let l=null,o=null;e.status?(l=e.data,o=e.token):(e.user||e.data)&&(l=e.user||e.data,o=e.token||e.access_token),l&&o?(U.setUser(l,o),(0,d.Nq)({accountId:l.id,email:l.email,fullName:l.name||l.fullName||l.email,role:l.role||(l.is_admin?"admin":"user"),loginAt:(new Date).toISOString()}),console.log("[Login] User stored:",U.getUser),s.notify({type:"positive",message:"Welcome back!",position:"top"}),await a.push({name:"account-select"}),console.log("[Login] Navigation triggered")):(console.error("[Login] Invalid response format:",e),R.value=e.msg||"Login failed - invalid response")}catch(e){console.error("Login error:",e),R.value=e.response?.data?.msg||e.message||"Login failed. Please try again."}finally{E.value=!1}}else R.value="Please enter a valid email address";else R.value="Please fill in all fields"},$=async()=>{R.value="",I.value=!0;try{const e=await(0,u.userLogin)({email:"demo@mycities.co.za",password:"demo123"});console.log("[Login] Demo login response:",e);let l=null,o=null;e.status?(l=e.data,o=e.token):(e.user||e.data)&&(l=e.user||e.data,o=e.token||e.access_token),l&&o?(U.setUser(l,o),console.log("[Login] User stored:",U.getUser),s.notify({type:"positive",message:"Welcome to the demo!",position:"top"}),await a.push({name:"account-select"}),console.log("[Login] Navigation triggered")):(console.error("[Login] Invalid response format:",e),R.value=e.msg||"Demo login failed - invalid response")}catch(e){console.error("Demo login error:",e),R.value=e.response?.data?.msg||e.message||"Demo login failed. Please try again."}finally{I.value=!1}},q=()=>{a.push({name:"register"})},z=()=>{a.push({name:"forgot-password"})};return(e,a)=>{const s=(0,l.g2)("q-icon"),n=(0,l.g2)("q-page");return(0,l.uX)(),(0,l.Wv)(n,{class:"login-page","data-test":"login-page"},{default:(0,l.k6)(()=>[a[10]||(a[10]=(0,l.Lk)("div",{class:"header-bar"},[(0,l.Lk)("span",null,"MyCities")],-1)),(0,l.Lk)("div",g,[(0,l.Lk)("div",v,[(0,l.Lk)("div",m,[(0,l.bF)(s,{name:"water_drop",size:"64px"})]),a[3]||(a[3]=(0,l.Lk)("h1",{class:"app-title"},"MyCities",-1)),a[4]||(a[4]=(0,l.Lk)("p",{class:"app-subtitle"},"Water & Electricity Meter Reading",-1))]),(0,l.Lk)("div",p,[R.value?((0,l.uX)(),(0,l.CE)("div",k,(0,o.v_)(R.value),1)):(0,l.Q3)("",!0),(0,l.Lk)("form",{onSubmit:(0,t.D$)(N,["prevent"]),class:"login-form"},[(0,l.Lk)("div",L,[a[5]||(a[5]=(0,l.Lk)("label",{class:"field-label"},"Email",-1)),(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),type:"email",class:"field-input",placeholder:"Enter your email","data-test":"login-email"},null,512),[[t.Jo,C.value]])]),(0,l.Lk)("div",f,[a[6]||(a[6]=(0,l.Lk)("label",{class:"field-label"},"Password",-1)),(0,l.Lk)("div",b,[(0,l.bo)((0,l.Lk)("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),type:A.value?"text":"password",class:"field-input",placeholder:"Enter your password","data-test":"login-password"},null,8,y),[[t.hp,P.value]]),(0,l.Lk)("button",{type:"button",class:"toggle-password",onClick:a[2]||(a[2]=e=>A.value=!A.value)},[(0,l.bF)(s,{name:A.value?"visibility_off":"visibility"},null,8,["name"])])])]),(0,l.Lk)("button",{type:"submit",class:"btn-primary",disabled:E.value,"data-test":"login-submit"},(0,o.v_)(E.value?"Signing in...":"Sign In"),9,h)],32),a[8]||(a[8]=(0,l.Lk)("div",{class:"divider"},[(0,l.Lk)("span",null,"or")],-1)),(0,l.Lk)("button",{class:"btn-secondary",disabled:I.value,onClick:$,"data-test":"login-demo"},(0,o.v_)(I.value?"Loading...":"Use Demo Account"),9,w),(0,l.Lk)("div",_,[(0,l.Lk)("a",{href:"#",onClick:(0,t.D$)(z,["prevent"]),"data-test":"login-forgot-password"}," Forgot Password? ")]),(0,l.Lk)("div",D,[a[7]||(a[7]=(0,l.Lk)("span",null,"Don't have an account?",-1)),(0,l.Lk)("a",{href:"#",onClick:(0,t.D$)(q,["prevent"]),"data-test":"login-create-account"}," Create Account ")])]),a[9]||(a[9]=(0,l.Lk)("div",{class:"demo-hint"},[(0,l.Lk)("p",null,"Demo: demo@mycities.co.za / demo123")],-1))])]),_:1})}}};var C=s(2807),P=s(7716),A=s(492),E=s(8582),I=s.n(E);const R=(0,C.A)(U,[["__scopeId","data-v-0ba57bb1"]]),K=R;I()(U,"components",{QPage:P.A,QIcon:A.A})}}]);