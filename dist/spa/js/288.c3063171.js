"use strict";(globalThis["webpackChunkcom_smart_meter_reading"]=globalThis["webpackChunkcom_smart_meter_reading"]||[]).push([[288],{5288:(e,a,t)=>{t.r(a),t.d(a,{default:()=>Q});var l=t(1758),r=t(8790),n=t(8734),s=t(3394),i=t(4907),c=t(7677);const d={class:"header-bar"},o={class:"nav-row"},u={class:"due-badge"},v={class:"period-text"},k={class:"meter-section","data-test":"water-meter-section"},p={class:"meter-type-header"},g={class:"meter-number"},b={class:"reading-history"},m={class:"reading-row"},L={class:"reading-label"},y={class:"reading-value"},w={class:"date-selector-section"},_={class:"digit-display-container"},R={class:"digits red"},h={key:0,class:"cursor-blink red"},C={class:"digits black"},D={key:0,class:"cursor-blink"},f={class:"keypad-container","data-test":"keypad"},E={class:"keypad-grid"},W=["data-test","onClick"],A={class:"back-button-container"},S={__name:"WaterReadingPage",setup(e){const a=(0,s.rd)(),t=(0,i.A)(),S=(0,n.KR)(null),B=(0,n.KR)(null),G=(0,n.KR)("red"),I=(0,n.KR)(null),K=(0,n.KR)(""),V=(0,n.KR)(""),F=(0,n.KR)((new Date).toISOString().split("T")[0]),$=["1","2","3","4","5","6","7","8","9","clear","0","backspace"];(0,l.sV)(()=>{c.Ay.initializeSeedData(),I.value=c.Ay.getDashboardData()});const N=(0,l.EW)(()=>I.value?.water?.meterNumber||"132452"),Q=(0,l.EW)(()=>{if(!I.value?.water?.startReading?.date)return"10th April";const e=new Date(I.value.water.startReading.date);return e.toLocaleDateString("en-GB",{day:"numeric",month:"long"})}),T=(0,l.EW)(()=>{if(!I.value?.water?.startReading)return"00140 - 45";const e=I.value.water.startReading;return e.fullReading||`${e.redValue}-${e.blackValue}`}),q=(0,l.EW)(()=>{const e=new Date;return e.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}),P=(0,l.EW)(()=>I.value?.period?.daysUntilDue||17),X=(0,l.EW)(()=>{if(!I.value?.period?.startDate)return"10 Apr 2025";const e=new Date(I.value.period.startDate);return e.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}),x=(0,l.EW)(()=>{if(!I.value?.period?.endDate)return"10 May 2025";const e=new Date(I.value.period.endDate);return e.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}),M=(0,l.EW)(()=>K.value||"0"),z=(0,l.EW)(()=>V.value||"0"),U=()=>{console.log("Go to previous period")},O=()=>{console.log("Go to next period")},j=()=>{a.back()},H=e=>{G.value=e},J=e=>{if("backspace"===e)Z();else if("clear"===e)ee();else{if("."===e)return;Y(e)}},Y=e=>{"red"===G.value?K.value.length<6&&(K.value+=e):"black"===G.value&&V.value.length<4&&(V.value+=e)},Z=()=>{"red"===G.value?K.value=K.value.slice(0,-1):"black"===G.value&&(V.value=V.value.slice(0,-1))},ee=()=>{"red"===G.value?K.value="":"black"===G.value&&(V.value="")},ae=()=>{K.value="",V.value="",a.back()},te=()=>{const e=M.value,l=z.value,r=`${e}-${l}`,n=parseFloat(e)+parseFloat(l)/100,s=c.Ay.getCurrentBillingPeriod();c.Ay.saveWaterReading({meterId:"WM-132452",periodId:s?.id||"period-2025-04",redValue:e,blackValue:l,fullReading:r,kiloliters:n,type:"end",isEstimated:!1,date:F.value});const i=new Date(F.value).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});t.notify({type:"positive",message:`Water reading saved: ${r} on ${i}`,position:"top"}),a.push({name:"home"})};return(e,a)=>{const t=(0,l.g2)("q-icon"),n=(0,l.g2)("q-input"),s=(0,l.g2)("q-btn"),i=(0,l.g2)("q-page");return(0,l.uX)(),(0,l.Wv)(i,{class:"water-reading-page","data-test":"water-reading-page"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",d,[(0,l.Lk)("span",null,"Current date: "+(0,r.v_)(q.value),1)]),(0,l.Lk)("div",o,[(0,l.Lk)("button",{class:"nav-arrow",onClick:U},[...a[3]||(a[3]=[(0,l.Lk)("span",{class:"arrow-icon"},"◀",-1)])]),(0,l.Lk)("div",u," Final Reading due in "+(0,r.v_)(P.value)+" days ",1),(0,l.Lk)("button",{class:"nav-arrow",onClick:O},[...a[4]||(a[4]=[(0,l.Lk)("span",{class:"arrow-icon"},"▶",-1)])])]),a[9]||(a[9]=(0,l.Lk)("div",{class:"page-title"},"ENTER WATER READING",-1)),(0,l.Lk)("div",v,"Period - "+(0,r.v_)(X.value)+" to "+(0,r.v_)(x.value),1),(0,l.Lk)("div",{class:"content-scroll",ref_key:"contentScrollRef",ref:S},[(0,l.Lk)("div",k,[(0,l.Lk)("div",p,[(0,l.bF)(t,{name:"water_drop",size:"24px",class:"meter-icon"}),a[5]||(a[5]=(0,l.Lk)("span",{class:"meter-type-name"},"Water",-1))]),(0,l.Lk)("div",g,"Meter Number #"+(0,r.v_)(N.value),1),(0,l.Lk)("div",b,[(0,l.Lk)("div",m,[(0,l.Lk)("span",L,"Start Reading "+(0,r.v_)(Q.value),1),(0,l.Lk)("span",y,(0,r.v_)(T.value),1)])]),(0,l.Lk)("div",w,[a[6]||(a[6]=(0,l.Lk)("label",{class:"date-label"},"Reading Date:",-1)),(0,l.bF)(n,{modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=e=>F.value=e),type:"date",filled:"",dense:"",class:"date-input","data-test":"reading-date-input"},null,8,["modelValue"])]),(0,l.Lk)("div",{class:"digit-input-section",ref_key:"waterDigitRef",ref:B},[(0,l.Lk)("div",_,[(0,l.Lk)("div",{class:(0,r.C4)(["digit-group red-group",{active:"red"===G.value}]),onClick:a[1]||(a[1]=e=>H("red")),"data-test":"water-red-group"},[(0,l.Lk)("span",R,(0,r.v_)(M.value),1),"red"===G.value&&""===K.value?((0,l.uX)(),(0,l.CE)("span",h,"|")):(0,l.Q3)("",!0)],2),a[7]||(a[7]=(0,l.Lk)("span",{class:"digit-separator"},"-",-1)),(0,l.Lk)("div",{class:(0,r.C4)(["digit-group black-group",{active:"black"===G.value}]),onClick:a[2]||(a[2]=e=>H("black")),"data-test":"water-black-group"},[(0,l.Lk)("span",C,(0,r.v_)(z.value),1),"black"===G.value&&""===V.value?((0,l.uX)(),(0,l.CE)("span",D,"|")):(0,l.Q3)("",!0)],2)])],512)]),a[8]||(a[8]=(0,l.Lk)("div",{class:"keypad-spacer"},null,-1))],512),(0,l.Lk)("div",f,[(0,l.Lk)("div",E,[((0,l.uX)(),(0,l.CE)(l.FK,null,(0,l.pI)($,e=>(0,l.Lk)("button",{key:e,class:(0,r.C4)(["keypad-btn",{"clear-btn":"clear"===e}]),"data-test":`keypad-${e}`,onClick:a=>J(e)},(0,r.v_)("backspace"===e?"⌫":"clear"===e?"C":e),11,W)),64))]),(0,l.Lk)("div",{class:"keypad-actions"},[(0,l.Lk)("button",{class:"action-btn cancel",onClick:ae,"data-test":"keypad-cancel"}," CANCEL "),(0,l.Lk)("button",{class:"action-btn enter",onClick:te,"data-test":"keypad-enter"}," ENTER ")])]),(0,l.Lk)("div",A,[(0,l.bF)(s,{flat:"",color:"primary",label:"Back",icon:"arrow_back",onClick:j,"data-test":"back-button"})])]),_:1})}}};var B=t(2807),G=t(7716),I=t(492),K=t(9270),V=t(6384),F=t(8582),$=t.n(F);const N=(0,B.A)(S,[["__scopeId","data-v-430cdbae"]]),Q=N;$()(S,"components",{QPage:G.A,QIcon:I.A,QInput:K.A,QBtn:V.A})}}]);