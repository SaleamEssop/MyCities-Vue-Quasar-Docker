"use strict";(globalThis["webpackChunkcom_smart_meter_reading"]=globalThis["webpackChunkcom_smart_meter_reading"]||[]).push([[212],{2322:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Jt});a(310),a(2203),a(95),a(6724),a(199);var l=a(1758),r=a(8734),n=a(8790),o=a(4907),i=a(485),s=a(2255),d=a(1393),u=a(9004),c=a(660);class m{async getBill(e,t={}){const{mode:a="estimate",period_start:l,period_end:r,idempotency_key:n}=t,o={account_id:e,mode:a};l&&(o.period_start=l),r&&(o.period_end=r),n&&(o.idempotency_key=n);try{const e=await c.api.get("/v1/bills",{params:o});return{status:!0,data:e.data||e}}catch(e){return console.error("Billing API error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to fetch bill",data:null}}}async finalizeBill(e,t={}){const{period_start:a,period_end:l,idempotency_key:r}=t,n={account_id:e,mode:"finalize"};a&&(n.period_start=a),l&&(n.period_end=l),r&&(n.idempotency_key=r);try{const e=await c.api.post("/v1/bills",n);return{status:!0,data:e.data||e}}catch(e){return console.error("Billing finalize error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to finalize bill",data:null}}}async recomputeBill(e){try{const t=await c.api.post(`/v1/bills/${e}/recompute`);return{status:!0,data:t.data||t}}catch(e){return console.error("Bill recompute error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to recompute bill",data:null}}}async getBillById(e){try{const t=await c.api.get(`/v1/bills/${e}`);return{status:!0,data:t.data||t}}catch(e){return console.error("Get bill error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to fetch bill",data:null}}}async listBills(e,t={}){const a={account_id:e,...t};try{const e=await c.api.get("/v1/bills",{params:a});return{status:!0,data:e.data||e}}catch(e){return console.error("List bills error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to list bills",data:null}}}}new m;class p{async editReading(e,t){try{const a=await c.api.post(`/v1/admin/readings/${e}/edit`,{value:t.value,reason:t.reason,is_rollover:t.is_rollover||!1,rollover_reason_code:t.rollover_reason_code||null});return{status:!0,data:a.data}}catch(e){return console.error("Admin edit reading error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to edit reading",data:null}}}async deleteReading(e,t){try{const a=await c.api.post(`/v1/admin/readings/${e}/delete`,{reason:t});return{status:!0,data:a.data}}catch(e){return console.error("Admin delete reading error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to delete reading",data:null}}}async addReading(e){try{const t=await c.api.post("/v1/admin/readings/add",{meter_id:e.meter_id,meter_reading_date:e.meter_reading_date,meter_reading:e.meter_reading,reason:e.reason,is_rollover:e.is_rollover||!1,rollover_reason_code:e.rollover_reason_code||null,bypass_cooldown:!0});return{status:!0,data:t.data}}catch(e){return console.error("Admin add reading error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to add reading",data:null}}}async recomputeBill(e,t=""){try{const a=await c.api.post(`/v1/admin/bills/${e}/recompute`,{reason:t});return{status:!0,data:a.data,job_id:a.data?.job_id}}catch(e){return console.error("Admin recompute bill error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to recompute bill",data:null}}}async recomputeAccountBill(e,t=""){try{const a=await c.api.post(`/v1/admin/accounts/${e}/recompute-bill`,{reason:t});return{status:!0,data:a.data,job_id:a.data?.job_id}}catch(e){return console.error("Admin recompute account bill error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to recompute bill",data:null}}}async getAuditLog(e={}){try{const t=await c.api.get("/v1/admin/audit-log",{params:e});return{status:!0,data:t.data}}catch(e){return console.error("Get audit log error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to fetch audit log",data:null}}}async undoAction(e,t){try{const a=await c.api.post(`/v1/admin/actions/${e}/undo`,{reason:t});return{status:!0,data:a.data}}catch(e){return console.error("Undo admin action error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to undo action",data:null}}}async getReadingHistory(e,t={}){try{const a=await c.api.get(`/v1/admin/meters/${e}/readings`,{params:t});return{status:!0,data:a.data}}catch(e){return console.error("Get reading history error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to fetch reading history",data:null}}}async setReadingFlags(e,t,a){try{const l=await c.api.post(`/v1/admin/readings/${e}/flags`,{...t,reason:a});return{status:!0,data:l.data}}catch(e){return console.error("Set reading flags error:",e),{status:!1,error:e.response?.data?.message||e.message||"Failed to set flags",data:null}}}async checkAdminRole(){try{const e=await c.api.get("/v1/admin/check-role");return{status:!0,isAdmin:e.data?.is_admin||!1,role:e.data?.role||"user"}}catch(e){return 403===e.response?.status?{status:!0,isAdmin:!1,role:"user"}:(console.error("Check admin role error:",e),{status:!1,isAdmin:!1,error:e.message})}}}const g=new p;var v=a(2807),y=a(3954),b=a(8582),f=a.n(b);const k={};f()(k,"components",{QBadge:y.A});const w={class:"row items-center justify-between q-mb-md"},h={class:"text-subtitle1 text-weight-bold"},_={key:0,class:"text-body2 text-grey-7 q-mb-md"},A={class:"charges-list"},F={class:"row items-center justify-between q-py-sm"},x={class:"row items-center"},C={class:"text-body2 text-weight-medium"},S={class:"row items-center justify-between q-py-sm"},q={class:"row items-center"},R={class:"text-body2 text-weight-medium"},E={class:"row items-center justify-between q-py-sm"},L={class:"row items-center"},V={class:"text-body2 text-weight-medium"},B={class:"row items-center justify-between q-py-xs"},Q={class:"text-body2"},$={class:"row items-center justify-between q-py-xs"},D={class:"text-body2"},I={class:"row items-center justify-between q-py-sm"},W={class:"text-h5 text-primary text-weight-bold"},j={key:1,class:"text-center q-mt-md"},T={class:"text-body1 text-weight-medium"},X={key:2,class:"q-mt-md"},N={class:"row q-gutter-sm"},K={__name:"BillCard",props:{waterCharges:{type:Number,default:0},electricityCharges:{type:Number,default:0},fixedCharges:{type:Number,default:0},vat:{type:Number,default:0},total:{type:Number,default:0},periodStart:{type:String,default:""},periodEnd:{type:String,default:""},dueDate:{type:String,default:""},isProjected:{type:Boolean,default:!0},mode:{type:String,default:"user"}},emits:["recompute","view-json"],setup(e){const t=e,a=(0,l.EW)(()=>t.waterCharges+t.electricityCharges+t.fixedCharges),r=e=>Number(e).toLocaleString("en-ZA",{minimumFractionDigits:2,maximumFractionDigits:2}),o=e=>e?new Date(e).toLocaleDateString("en-ZA",{day:"numeric",month:"short",year:"numeric"}):"";return(t,i)=>{const s=(0,l.g2)("q-badge"),d=(0,l.g2)("q-icon"),u=(0,l.g2)("q-avatar"),c=(0,l.g2)("q-separator"),m=(0,l.g2)("q-btn"),p=(0,l.g2)("q-card-section"),g=(0,l.g2)("q-card");return(0,l.uX)(),(0,l.Wv)(g,{flat:"",bordered:"",class:"bill-card"},{default:(0,l.k6)(()=>[(0,l.bF)(p,null,{default:(0,l.k6)(()=>[(0,l.Lk)("div",w,[(0,l.Lk)("div",h,(0,n.v_)(e.isProjected?"Projected Bill":"Bill Summary"),1),(0,l.bF)(s,{color:e.isProjected?"warning":"positive","text-color":"white"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(e.isProjected?"Projected":"Final"),1)]),_:1},8,["color"])]),e.periodStart&&e.periodEnd?((0,l.uX)(),(0,l.CE)("div",_," Period: "+(0,n.v_)(o(e.periodStart))+" - "+(0,n.v_)(o(e.periodEnd)),1)):(0,l.Q3)("",!0),(0,l.Lk)("div",A,[(0,l.Lk)("div",F,[(0,l.Lk)("div",x,[(0,l.bF)(u,{size:"28px",color:"cyan","text-color":"white",class:"q-mr-sm"},{default:(0,l.k6)(()=>[(0,l.bF)(d,{name:"water_drop",size:"16px"})]),_:1}),i[2]||(i[2]=(0,l.Lk)("span",{class:"text-body2"},"Water",-1))]),(0,l.Lk)("span",C,"R "+(0,n.v_)(r(e.waterCharges)),1)]),(0,l.Lk)("div",S,[(0,l.Lk)("div",q,[(0,l.bF)(u,{size:"28px",color:"amber-8","text-color":"white",class:"q-mr-sm"},{default:(0,l.k6)(()=>[(0,l.bF)(d,{name:"bolt",size:"16px"})]),_:1}),i[3]||(i[3]=(0,l.Lk)("span",{class:"text-body2"},"Electricity",-1))]),(0,l.Lk)("span",R,"R "+(0,n.v_)(r(e.electricityCharges)),1)]),(0,l.Lk)("div",E,[(0,l.Lk)("div",L,[(0,l.bF)(u,{size:"28px",color:"grey-6","text-color":"white",class:"q-mr-sm"},{default:(0,l.k6)(()=>[(0,l.bF)(d,{name:"receipt_long",size:"16px"})]),_:1}),i[4]||(i[4]=(0,l.Lk)("span",{class:"text-body2"},"Fixed Charges",-1))]),(0,l.Lk)("span",V,"R "+(0,n.v_)(r(e.fixedCharges)),1)]),(0,l.bF)(c,{class:"q-my-sm"}),(0,l.Lk)("div",B,[i[5]||(i[5]=(0,l.Lk)("span",{class:"text-body2 text-grey-7"},"Subtotal",-1)),(0,l.Lk)("span",Q,"R "+(0,n.v_)(r(a.value)),1)]),(0,l.Lk)("div",$,[i[6]||(i[6]=(0,l.Lk)("span",{class:"text-body2 text-grey-7"},"VAT (15%)",-1)),(0,l.Lk)("span",D,"R "+(0,n.v_)(r(e.vat)),1)]),(0,l.bF)(c,{class:"q-my-sm"}),(0,l.Lk)("div",I,[i[7]||(i[7]=(0,l.Lk)("span",{class:"text-subtitle1 text-weight-bold"},"Total",-1)),(0,l.Lk)("span",W,"R "+(0,n.v_)(r(e.total)),1)])]),e.dueDate?((0,l.uX)(),(0,l.CE)("div",j,[i[8]||(i[8]=(0,l.Lk)("div",{class:"text-caption text-grey-7"},"Due Date",-1)),(0,l.Lk)("div",T,(0,n.v_)(o(e.dueDate)),1)])):(0,l.Q3)("",!0),"admin"===e.mode?((0,l.uX)(),(0,l.CE)("div",X,[(0,l.bF)(c,{class:"q-mb-md"}),(0,l.Lk)("div",N,[(0,l.bF)(m,{flat:"",dense:"",color:"primary",icon:"calculate",label:"Recompute",onClick:i[0]||(i[0]=e=>t.$emit("recompute"))}),(0,l.bF)(m,{flat:"",dense:"",color:"primary",icon:"code",label:"View JSON",onClick:i[1]||(i[1]=e=>t.$emit("view-json"))})])])):(0,l.Q3)("",!0)]),_:1})]),_:1})}}};var M=a(3316),U=a(4189),P=a(3952),G=a(492),O=a(386),z=a(6384);f()(K,"components",{QCard:M.A,QCardSection:U.A,QBadge:y.A,QAvatar:P.A,QIcon:G.A,QSeparator:O.A,QBtn:z.A});const H={__name:"MeterRow",props:{title:{type:String,default:""},subtitle:{type:String,default:""},clickable:{type:Boolean,default:!1}},emits:["click"],setup(e){return(t,a)=>{const r=(0,l.g2)("q-item-label"),o=(0,l.g2)("q-item-section"),i=(0,l.g2)("q-item");return(0,l.uX)(),(0,l.Wv)(i,(0,l.v6)({clickable:e.clickable},t.$attrs,{onClick:a[0]||(a[0]=e=>t.$emit("click",e))}),{default:(0,l.k6)(()=>[(0,l.bF)(o,null,{default:(0,l.k6)(()=>[(0,l.bF)(r,{class:"text-body1"},{default:(0,l.k6)(()=>[(0,l.RG)(t.$slots,"title",{},()=>[(0,l.eW)((0,n.v_)(e.title),1)])]),_:3}),(0,l.bF)(r,{caption:""},{default:(0,l.k6)(()=>[(0,l.RG)(t.$slots,"subtitle",{},()=>[(0,l.eW)((0,n.v_)(e.subtitle),1)])]),_:3})]),_:3}),(0,l.bF)(o,{side:""},{default:(0,l.k6)(()=>[(0,l.RG)(t.$slots,"side")]),_:3})]),_:3},16,["clickable"])}}};var J=a(124),Z=a(5173),Y=a(3796);f()(H,"components",{QItem:J.A,QItemSection:Z.A,QItemLabel:Y.A});const ee={__name:"ButtonPrimary",props:{label:{type:String,default:"Submit"},color:{type:String,default:"primary"},textColor:{type:String,default:"black"},unelevated:{type:Boolean,default:!0},outline:{type:Boolean,default:!1},rounded:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},disable:{type:Boolean,default:!1},icon:{type:String,default:null},type:{type:String,default:"button"}},emits:["click"],setup(e){return(t,a)=>{const r=(0,l.g2)("q-btn");return(0,l.uX)(),(0,l.Wv)(r,(0,l.v6)({label:e.label,color:e.color,"text-color":e.textColor,unelevated:e.unelevated,outline:e.outline,rounded:e.rounded,loading:e.loading,disable:e.disable,icon:e.icon,type:e.type},t.$attrs,{onClick:a[0]||(a[0]=e=>t.$emit("click",e))}),null,16,["label","color","text-color","unelevated","outline","rounded","loading","disable","icon","type"])}}},te=ee,ae=te;f()(ee,"components",{QBtn:z.A});const le={__name:"ConfirmModal",props:{modelValue:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,default:""},confirmLabel:{type:String,default:"OK"}},emits:["update:modelValue","confirm","cancel"],setup(e,{emit:t}){const a=e,o=t,i=(0,r.KR)(a.modelValue);(0,l.wB)(()=>a.modelValue,e=>{i.value=e});const s=()=>{i.value=!1,o("update:modelValue",!1),o("cancel")},d=()=>{i.value=!1,o("update:modelValue",!1),o("confirm")};return(t,a)=>{const r=(0,l.g2)("q-card-section"),o=(0,l.g2)("q-btn"),u=(0,l.g2)("q-card-actions"),c=(0,l.g2)("q-card"),m=(0,l.g2)("q-dialog");return(0,l.uX)(),(0,l.Wv)(m,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),persistent:""},{default:(0,l.k6)(()=>[(0,l.bF)(c,null,{default:(0,l.k6)(()=>[(0,l.bF)(r,{class:"text-h6"},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(e.title),1)]),_:1}),(0,l.bF)(r,{class:"text-body2"},{default:(0,l.k6)(()=>[(0,l.RG)(t.$slots,"default",{},()=>[(0,l.eW)((0,n.v_)(e.message),1)])]),_:3}),(0,l.bF)(u,{align:"right"},{default:(0,l.k6)(()=>[(0,l.bF)(o,{flat:"",label:"Cancel",color:"primary",onClick:s}),(0,l.bF)(ae,{label:e.confirmLabel,onClick:d},null,8,["label"])]),_:1})]),_:3})]),_:3},8,["modelValue"])}}};var re=a(2156),ne=a(2669);f()(le,"components",{QDialog:re.A,QCard:M.A,QCardSection:U.A,QCardActions:ne.A,QBtn:z.A});const oe={__name:"FormInput",props:{modelValue:[String,Number],label:{type:String,default:""},type:{type:String,default:"text"},placeholder:{type:String,default:""},dense:{type:Boolean,default:!0},outlined:{type:Boolean,default:!0},error:{type:Boolean,default:!1},errorMessage:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,r=t,n=(0,l.EW)({get:()=>a.modelValue,set:e=>r("update:modelValue",e)});return(t,a)=>{const r=(0,l.g2)("q-input");return(0,l.uX)(),(0,l.Wv)(r,(0,l.v6)({modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),label:e.label,type:e.type,placeholder:e.placeholder,dense:e.dense,outlined:e.outlined,error:e.error,"error-message":e.errorMessage},t.$attrs,{"onUpdate:modelValue":a[1]||(a[1]=e=>t.$emit("update:modelValue",e))}),null,16,["modelValue","label","type","placeholder","dense","outlined","error","error-message"])}}};var ie=a(9270);f()(oe,"components",{QInput:ie.A});const se={class:"bill-header"},de={class:"current-date"},ue={class:"nav-row"},ce={class:"days"},me={key:0,class:"header-amount"},pe={key:1,class:"page-title"},ge={class:"period-text"};function ve(e,t,a,r,o,i){const s=(0,l.g2)("q-btn"),d=(0,l.g2)("q-badge");return(0,l.uX)(),(0,l.CE)("div",se,[(0,l.Lk)("div",de,"Current date: "+(0,n.v_)(e.formatDate(e.currentDate)),1),(0,l.Lk)("div",ue,[(0,l.bF)(s,{flat:"",round:"",dense:"",icon:"chevron_left",disable:!e.canGoPrev,onClick:t[0]||(t[0]=t=>e.$emit("prev")),class:"nav-arrow-btn"},null,8,["disable"]),(0,l.bF)(d,{color:e.badgeColor,"text-color":"white",class:"due-badge"},{default:(0,l.k6)(()=>[t[2]||(t[2]=(0,l.eW)(" Final Reading due in ",-1)),(0,l.Lk)("span",ce,(0,n.v_)(e.daysUntilDue)+" days",1)]),_:1},8,["color"]),(0,l.bF)(s,{flat:"",round:"",dense:"",icon:"chevron_right",disable:!e.canGoNext,onClick:t[1]||(t[1]=t=>e.$emit("next")),class:"nav-arrow-btn"},null,8,["disable"])]),e.showAmount?((0,l.uX)(),(0,l.CE)("div",me,"R"+(0,n.v_)(e.formatCurrency(e.amount)),1)):(0,l.Q3)("",!0),e.showTitle?((0,l.uX)(),(0,l.CE)("div",pe,(0,n.v_)(e.title),1)):(0,l.Q3)("",!0),(0,l.Lk)("div",ge,"Period - "+(0,n.v_)(e.periodStart)+" to "+(0,n.v_)(e.periodEnd),1)])}const ye=(0,l.pM)({name:"BillHeader",props:{currentDate:{type:Date,default:()=>new Date},daysUntilDue:{type:Number,required:!0},periodStart:{type:String,required:!0},periodEnd:{type:String,required:!0},amount:{type:Number,default:0},showAmount:{type:Boolean,default:!1},title:{type:String,default:""},showTitle:{type:Boolean,default:!1},canGoPrev:{type:Boolean,default:!0},canGoNext:{type:Boolean,default:!0}},emits:["prev","next"],setup(e){const t=(0,l.EW)(()=>e.daysUntilDue<=3?"negative":e.daysUntilDue<=7?"warning":"positive"),a=e=>e.toLocaleDateString("en-ZA",{day:"numeric",month:"short",year:"numeric"}),r=e=>e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");return{badgeColor:t,formatDate:a,formatCurrency:r}}}),be=(0,v.A)(ye,[["render",ve],["__scopeId","data-v-d87405a8"]]),fe=be;f()(ye,"components",{QBtn:z.A,QBadge:y.A});const ke={class:"meter-icon"},we={key:0,class:"meter-stats"},he={class:"stat-label"},_e={class:"stat-value"},Ae={key:1,class:"meter-name"};function Fe(e,t,a,r,o,i){const s=(0,l.g2)("q-icon");return(0,l.uX)(),(0,l.CE)("div",{class:(0,n.C4)(["meter-bar",e.type])},[(0,l.Lk)("div",ke,[(0,l.bF)(s,{name:e.icon,size:"45px",color:"white"},null,8,["name"])]),e.showStats?((0,l.uX)(),(0,l.CE)("div",we,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.stats,(e,t)=>((0,l.uX)(),(0,l.CE)("div",{class:"stat-item",key:t},[(0,l.Lk)("div",he,(0,n.v_)(e.label),1),(0,l.Lk)("div",_e,(0,n.v_)(e.value),1)]))),128))])):((0,l.uX)(),(0,l.CE)("span",Ae,(0,n.v_)(e.name),1))],2)}const xe=(0,l.pM)({name:"MeterBar",props:{type:{type:String,default:"water",validator:e=>["water","electricity"].includes(e)},name:{type:String,default:"Water"},icon:{type:String,default:"water_drop"},stats:{type:Array,default:()=>[]},showStats:{type:Boolean,default:!1}}}),Ce=(0,v.A)(xe,[["render",Fe],["__scopeId","data-v-6505fbce"]]),Se=Ce;f()(xe,"components",{QIcon:G.A});const qe={class:"action-links"},Re=["onClick"];function Ee(e,t,a,r,o,i){return(0,l.uX)(),(0,l.CE)("div",qe,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.links,(t,a)=>((0,l.uX)(),(0,l.CE)("span",{key:a,class:(0,n.C4)(["action-link",{active:t.active,highlight:t.highlight}]),onClick:a=>e.$emit("click",t.action)},(0,n.v_)(t.label),11,Re))),128))])}a(317);const Le=(0,l.pM)({name:"ActionLinks",props:{links:{type:Array,required:!0,validator:e=>e.every(e=>"object"===typeof e&&e.label&&"string"===typeof e.action)}},emits:["click"]}),Ve=(0,v.A)(Le,[["render",Ee],["__scopeId","data-v-c372613e"]]),Be=Ve;const Qe=(0,l.pM)({name:"ReadingKeypad",props:{modelValue:{type:Boolean,default:!1},meterType:{type:String,default:"water",validator:e=>["water","electricity"].includes(e)},initialValue:{type:String,default:""}},emits:["update:modelValue","enter","cancel","change"],setup(e,{emit:t}){const a=(0,l.EW)({get:()=>e.modelValue,set:e=>t("update:modelValue",e)}),n=(0,l.EW)(()=>"water"===e.meterType?7:6),o=(0,l.EW)(()=>"water"===e.meterType),i=(0,r.KR)([]),s=(0,r.KR)([]),d=(0,r.KR)(null),u=(0,r.KR)(0),c=()=>{if(e.initialValue&&""!==e.initialValue)if("water"===e.meterType){const t=e.initialValue.includes("-")?e.initialValue.split("-"):[e.initialValue.slice(0,2),e.initialValue.slice(2)];s.value=t[0].padStart(2,"0").split(""),i.value=t[1].padStart(5,"0").split("")}else i.value=e.initialValue.padStart(6,"0").split(""),s.value=[];else"water"===e.meterType?(s.value=Array(2).fill("0"),i.value=Array(5).fill("0")):(i.value=Array(6).fill("0"),s.value=[]);u.value=0,d.value=null};(0,l.wB)(()=>e.modelValue,e=>{e&&c()},{immediate:!0});const m=(0,l.EW)(()=>i.value.join("")),p=(0,l.EW)(()=>s.value.join("")),g=e=>{d.value=e,u.value=0},v=["1","2","3","4","5","6","7","8","9",".","0","backspace"],y=e=>"backspace"===e?"⌫":e,b=a=>{if(!d.value)return;const l="black"===d.value?i.value:s.value,r="black"===d.value?"water"===e.meterType?5:6:2;if("backspace"===a){if("0"===l[r-1])for(let e=0;e<r;e++)l[e]="0";else l[r-1]="0";u.value=0}else{if("."===a)return;{const t="red"===d.value?"00"===p.value:"water"===e.meterType?"00000"===m.value:"000000"===m.value;t&&(u.value=0),u.value<r&&(l[u.value]=a,u.value<r-1&&u.value++)}}t("change",f())},f=()=>"water"===e.meterType?`${p.value}-${m.value}`:m.value,k=t=>"red"===t?"00"===p.value:"water"===e.meterType?"00000"===m.value:"000000"===m.value,w=()=>{t("cancel"),a.value=!1},h=()=>{t("enter",f()),a.value=!1};return{localVisible:a,totalDigits:n,showSeparator:o,blackGroupValue:m,redGroupValue:p,activeGroup:d,selectGroup:g,isGroupEmpty:k,keypadKeys:v,getKeyLabel:y,handleKeyPress:b,handleCancel:w,handleEnter:h}}});f()(Qe,"components",{QDialog:re.A,QCard:M.A,QBtn:z.A});(0,l.pM)({name:"MeterReadingEntry",props:{meterNumber:{type:String,required:!0},readings:{type:Array,default:()=>[],validator:e=>e.every(e=>e.label&&void 0!==e.value)},showAddLink:{type:Boolean,default:!0},cooldownActive:{type:Boolean,default:!1},cooldownHours:{type:Number,default:0},cooldownMinutes:{type:Number,default:0},meterType:{type:String,default:"water"}},emits:["add","edit"],setup(e){const t=e=>e?"object"===typeof e&&e.black&&e.red?`${e.black} - ${e.red}`:e:"";return{formatReading:t}}});var $e=a(9104);const De={class:"meter-usage-card"},Ie={class:"details-section"},We={class:"charge-label"},je={class:"charge-value"},Te={class:"projected-row"},Xe={class:"projected-value"};function Ne(e,t,a,r,o,i){const s=(0,l.g2)("MeterBar"),d=(0,l.g2)("ActionLinks"),u=(0,l.g2)("q-slide-transition");return(0,l.uX)(),(0,l.CE)("div",De,[(0,l.bF)(s,{type:e.meterType,name:e.meterName,icon:e.icon,stats:e.stats,"show-stats":!0},null,8,["type","name","icon","stats"]),(0,l.bF)(d,{links:e.actionLinks,onClick:e.handleActionClick},null,8,["links","onClick"]),(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.bo)((0,l.Lk)("div",Ie,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.charges,(t,a)=>((0,l.uX)(),(0,l.CE)("div",{key:a,class:"charge-row"},[(0,l.Lk)("span",We,(0,n.v_)(t.label),1),(0,l.Lk)("span",je,"R"+(0,n.v_)(e.formatCurrency(t.amount)),1)]))),128))],512),[[$e.aG,e.detailsOpen]])]),_:1}),(0,l.Lk)("div",Te,[t[0]||(t[0]=(0,l.Lk)("span",{class:"projected-label"},[(0,l.eW)("Projected charges "),(0,l.Lk)("span",{class:"projected-arrow"},"→")],-1)),(0,l.Lk)("span",Xe,"R "+(0,n.v_)(e.formatCurrency(e.projected)),1)])])}const Ke=(0,l.pM)({name:"MeterUsageCard",components:{MeterBar:Se,ActionLinks:Be},props:{meterType:{type:String,default:"water",validator:e=>["water","electricity"].includes(e)},meterName:{type:String,required:!0},icon:{type:String,default:"water_drop"},stats:{type:Array,required:!0},charges:{type:Array,default:()=>[]},projected:{type:Number,required:!0},showEnterReading:{type:Boolean,default:!0}},emits:["enter-reading"],setup(e,{emit:t}){const a=(0,r.KR)(!1),n=(0,l.EW)(()=>{const t=[];return e.showEnterReading&&t.push({label:"Enter reading",action:"enter-reading",active:!1}),t.push({label:a.value?"Hide Details":"Show Details",action:"toggle-details",highlight:!0}),t}),o=e=>{"toggle-details"===e?a.value=!a.value:"enter-reading"===e&&t("enter-reading")},i=e=>e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",");return{detailsOpen:a,actionLinks:n,handleActionClick:o,formatCurrency:i}}});var Me=a(3605);const Ue=(0,v.A)(Ke,[["render",Ne],["__scopeId","data-v-ec1f6fba"]]),Pe=Ue;f()(Ke,"components",{QSlideTransition:Me.A});const Ge={class:"digits-container"},Oe={__name:"MeterDigitDisplay",props:{value:{type:[Number,String],default:""},meterType:{type:String,default:"water"},isInput:{type:Boolean,default:!1}},setup(e){const t=e,a=(0,l.EW)(()=>"water"===t.meterType?8:6),r=(0,l.EW)(()=>"water"===t.meterType?4:1),o=(0,l.EW)(()=>{let e=String(t.value||"").replace(".","");if(t.isInput){const t=e.split("");while(t.length<a.value)t.push("_");return t.slice(0,a.value)}while(e.length<a.value)e="0"+e;return e.slice(-a.value).split("")}),i=(0,l.EW)(()=>"water"===t.meterType?"water-meter":"electricity-meter"),s=e=>{const l=e>=a.value-r.value;return"water"===t.meterType?l?"digit-decimal-water":"digit-whole":l?"digit-decimal-elec":"digit-whole-elec"};return(e,t)=>((0,l.uX)(),(0,l.CE)("div",{class:(0,n.C4)(["meter-digit-display",i.value])},[(0,l.Lk)("div",Ge,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(o.value,(e,t)=>((0,l.uX)(),(0,l.CE)("span",{key:t,class:(0,n.C4)(["digit-box text-h5",s(t)])},(0,n.v_)(e),3))),128))])],2))}},ze=(0,v.A)(Oe,[["__scopeId","data-v-7faec7fa"]]),He=ze,Je={class:"reading-history-row q-py-xs"},Ze={class:"row items-center justify-between"},Ye={class:"col"},et={class:"text-body2"},tt={key:0,class:"text-caption text-grey-7"},at={class:"col-auto text-right"},lt={class:"text-body2 text-weight-medium"},rt={__name:"ReadingHistoryRow",props:{label:{type:String,default:"Reading"},date:{type:[Date,String],required:!0},reading:{type:[Number,String],required:!0},readingType:{type:String,default:""},canEdit:{type:Boolean,default:!1},mode:{type:String,default:"user"}},emits:["edit"],setup(e){const t=e,a=(0,l.EW)(()=>{const e=new Date(t.date);return e.toLocaleDateString("en-GB",{day:"numeric",month:"short"})}),r=(0,l.EW)(()=>{const e=String(t.reading).replace(".","");return e});return(t,o)=>((0,l.uX)(),(0,l.CE)("div",Je,[(0,l.Lk)("div",Ze,[(0,l.Lk)("div",Ye,[(0,l.Lk)("div",et,(0,n.v_)(e.label)+" "+(0,n.v_)(a.value),1),e.readingType?((0,l.uX)(),(0,l.CE)("div",tt,(0,n.v_)(e.readingType),1)):(0,l.Q3)("",!0)]),(0,l.Lk)("div",at,[(0,l.Lk)("span",lt,(0,n.v_)(r.value),1),e.canEdit&&"admin"===e.mode?((0,l.uX)(),(0,l.CE)("a",{key:0,href:"#",class:"text-primary q-ml-sm text-body2",onClick:o[0]||(o[0]=(0,$e.D$)(e=>t.$emit("edit"),["prevent"]))}," Edit ")):(0,l.Q3)("",!0)])])]))}},nt=(0,v.A)(rt,[["__scopeId","data-v-b44ff856"]]),ot=nt,it={class:"admin-reading-toolbar bg-deep-purple-1 q-pa-sm q-mb-md",style:{"border-radius":"8px"}},st={class:"row items-center q-gutter-sm"},dt={__name:"AdminReadingToolbar",props:{selectedReadingId:{type:[Number,String],default:null}},emits:["add","edit","delete","recompute","view-json","audit-log"],setup(e){return(t,a)=>{const r=(0,l.g2)("q-btn"),n=(0,l.g2)("q-separator"),o=(0,l.g2)("q-space");return(0,l.uX)(),(0,l.CE)("div",it,[(0,l.Lk)("div",st,[(0,l.bF)(r,{dense:"",flat:"",color:"deep-purple",icon:"add",label:"Add Reading",onClick:a[0]||(a[0]=e=>t.$emit("add"))}),(0,l.bF)(r,{dense:"",flat:"",color:"deep-purple",icon:"edit",label:"Edit",disable:!e.selectedReadingId,onClick:a[1]||(a[1]=e=>t.$emit("edit"))},null,8,["disable"]),(0,l.bF)(r,{dense:"",flat:"",color:"negative",icon:"delete",label:"Delete",disable:!e.selectedReadingId,onClick:a[2]||(a[2]=e=>t.$emit("delete"))},null,8,["disable"]),(0,l.bF)(n,{vertical:"",inset:"",class:"q-mx-sm"}),(0,l.bF)(r,{dense:"",flat:"",color:"primary",icon:"refresh",label:"Recompute Bill",onClick:a[3]||(a[3]=e=>t.$emit("recompute"))}),(0,l.bF)(r,{dense:"",flat:"",color:"grey-7",icon:"code",label:"View JSON",onClick:a[4]||(a[4]=e=>t.$emit("view-json"))}),(0,l.bF)(o),(0,l.bF)(r,{dense:"",flat:"",color:"grey-7",icon:"history",label:"Audit Log",onClick:a[5]||(a[5]=e=>t.$emit("audit-log"))})])])}}};var ut=a(3676);const ct=dt,mt=ct;f()(dt,"components",{QBtn:z.A,QSeparator:O.A,QSpace:ut.A});const pt={class:"text-body2"},gt={__name:"CooldownWarning",props:{show:{type:Boolean,default:!1},secondsRemaining:{type:Number,default:0},mode:{type:String,default:"user"}},emits:["override"],setup(e){const t=e,a=(0,l.EW)(()=>{const e=Math.max(0,t.secondsRemaining),a=Math.floor(e/3600),l=Math.floor(e%3600/60);return a>0?`${a} hour${1!==a?"s":""} and ${l} minute${1!==l?"s":""}`:`${l} minute${1!==l?"s":""}`});return(t,r)=>{const o=(0,l.g2)("q-icon"),i=(0,l.g2)("q-btn"),s=(0,l.g2)("q-banner");return e.show?((0,l.uX)(),(0,l.Wv)(s,{key:0,dense:"",class:"bg-orange-1 text-orange-9 q-my-sm",style:{"border-radius":"8px"}},(0,l.eX)({avatar:(0,l.k6)(()=>[(0,l.bF)(o,{name:"schedule",color:"orange"})]),default:(0,l.k6)(()=>[(0,l.Lk)("div",pt,[r[1]||(r[1]=(0,l.eW)(" Sorry, your last reading was less than 24 hours ago. Please wait for ",-1)),(0,l.Lk)("strong",null,(0,n.v_)(a.value),1),r[2]||(r[2]=(0,l.eW)(" before you can add a reading. ",-1))])]),_:2},["admin"===e.mode?{name:"action",fn:(0,l.k6)(()=>[(0,l.bF)(i,{flat:"",dense:"",color:"deep-purple",label:"Override (Admin)",onClick:r[0]||(r[0]=e=>t.$emit("override"))})]),key:"0"}:void 0]),1024)):(0,l.Q3)("",!0)}}};var vt=a(6868);const yt=gt,bt=yt;f()(gt,"components",{QBanner:vt.A,QIcon:G.A,QBtn:z.A});const ft={class:"reading-entry-panel"},kt={class:"row items-center justify-center q-mb-md"},wt={class:"text-h5 text-weight-bold"},ht={class:"row justify-center q-mb-md"},_t={key:1,class:"q-px-md"},At={class:"text-center q-mb-md"},Ft={class:"text-body1 text-grey-8"},xt={class:"reading-history q-mb-md"},Ct={class:"text-center q-mb-md"},St={key:0,class:"q-mb-md"},qt={class:"text-center q-mb-md"},Rt={class:"text-center q-mt-md"},Et={key:2,class:"q-px-md"},Lt={__name:"ReadingEntryPanel",props:{meterId:{type:[Number,String],required:!0},meterNumber:{type:String,default:""},meterType:{type:String,default:"water"},readings:{type:Array,default:()=>[]},cooldownSecondsRemaining:{type:Number,default:0},dailyUsage:{type:[Number,String],default:0},totalUsage:{type:[Number,String],default:0},dailyCost:{type:Number,default:0},lineItems:{type:Array,default:()=>[]},projectedCharges:{type:Number,default:0},mode:{type:String,default:"user"},submitting:{type:Boolean,default:!1}},emits:["submit-reading","edit-reading","view-history","admin-add","admin-edit","admin-delete","admin-recompute","admin-view-json","admin-audit-log","cooldown-override"],setup(e,{emit:t}){const a=e,o=t,i=(0,r.KR)("enter"),s=(0,r.KR)(""),d=(0,r.KR)(!1),u=(0,r.KR)(null),c=(0,r.KR)(!1),m=(0,l.EW)(()=>"water"===a.meterType?"Water":"Electricity"),p=(0,l.EW)(()=>"water"===a.meterType?"water_drop":"bolt"),g=(0,l.EW)(()=>"water"===a.meterType?"bg-cyan":"bg-amber-8"),v=(0,l.EW)(()=>!c.value&&a.cooldownSecondsRemaining>0),y=(0,l.EW)(()=>a.readings.slice(0,5)),b=(0,l.EW)(()=>{const e=String(s.value).replace(/\D/g,""),t="water"===a.meterType?4:3;return e.length>=t}),f=e=>{"admin"===a.mode&&(u.value=u.value===e.id?null:e.id)},k=()=>{c.value=!0,o("cooldown-override")},w=()=>{b.value&&o("submit-reading",{meterId:a.meterId,value:s.value,meterType:a.meterType})};return(0,l.wB)(()=>a.readings,()=>{s.value="",d.value=!1},{deep:!0}),(t,a)=>{const r=(0,l.g2)("q-icon"),o=(0,l.g2)("q-btn-toggle"),c=(0,l.g2)("q-input"),h=(0,l.g2)("q-btn");return(0,l.uX)(),(0,l.CE)("div",ft,["admin"===e.mode?((0,l.uX)(),(0,l.Wv)(mt,{key:0,"selected-reading-id":u.value,onAdd:a[0]||(a[0]=e=>t.$emit("admin-add")),onEdit:a[1]||(a[1]=e=>t.$emit("admin-edit",u.value)),onDelete:a[2]||(a[2]=e=>t.$emit("admin-delete",u.value)),onRecompute:a[3]||(a[3]=e=>t.$emit("admin-recompute")),onViewJson:a[4]||(a[4]=e=>t.$emit("admin-view-json")),onAuditLog:a[5]||(a[5]=e=>t.$emit("admin-audit-log"))},null,8,["selected-reading-id"])):(0,l.Q3)("",!0),(0,l.Lk)("div",kt,[(0,l.Lk)("div",{class:(0,n.C4)(["meter-type-icon q-mr-sm",g.value])},[(0,l.bF)(r,{name:p.value,size:"md",color:"white"},null,8,["name"])],2),(0,l.Lk)("span",wt,(0,n.v_)(m.value),1)]),(0,l.Lk)("div",ht,[(0,l.bF)(o,{modelValue:i.value,"onUpdate:modelValue":a[6]||(a[6]=e=>i.value=e),flat:"","toggle-color":"primary",options:[{label:"Enter reading",value:"enter"},{label:"Show Details",value:"details"}]},null,8,["modelValue"])]),"enter"===i.value?((0,l.uX)(),(0,l.CE)("div",_t,[(0,l.Lk)("div",At,[(0,l.Lk)("div",Ft,"Meter Number #"+(0,n.v_)(e.meterNumber),1)]),(0,l.Lk)("div",xt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(y.value,(a,r)=>((0,l.uX)(),(0,l.Wv)(ot,{key:a.id||r,label:a.label,date:a.date,reading:a.value,"reading-type":a.type,"can-edit":a.canEdit,mode:e.mode,class:(0,n.C4)({"bg-blue-1":u.value===a.id}),onClick:e=>f(a),onEdit:e=>t.$emit("edit-reading",a)},null,8,["label","date","reading","reading-type","can-edit","mode","class","onClick","onEdit"]))),128))]),(0,l.Lk)("div",Ct,[(0,l.Lk)("a",{href:"#",class:"text-primary text-body2",onClick:a[7]||(a[7]=(0,$e.D$)(e=>d.value=!0,["prevent"]))}," Add new reading ")]),(0,l.bF)(bt,{show:v.value&&d.value,"seconds-remaining":e.cooldownSecondsRemaining,mode:e.mode,onOverride:k},null,8,["show","seconds-remaining","mode"]),!d.value||v.value&&"admin"!==e.mode?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",St,[(0,l.Lk)("div",qt,[(0,l.bF)(He,{value:s.value,"meter-type":e.meterType,"is-input":!0},null,8,["value","meter-type"])]),(0,l.bF)(c,{modelValue:s.value,"onUpdate:modelValue":a[8]||(a[8]=e=>s.value=e),type:"number",outlined:"",dense:"",class:"hidden-input",maxlength:"water"===e.meterType?8:6,autofocus:"",onKeyup:(0,$e.jR)(w,["enter"])},null,8,["modelValue","maxlength"]),(0,l.Lk)("div",Rt,[(0,l.bF)(h,{color:"primary",label:"UPDATE",class:"full-width",style:{"max-width":"300px"},loading:e.submitting,disable:!b.value,onClick:w},null,8,["loading","disable"])])]))])):(0,l.Q3)("",!0),"details"===i.value?((0,l.uX)(),(0,l.CE)("div",Et,[(0,l.bF)(Pe,{"meter-type":e.meterType,"daily-usage":e.dailyUsage,"total-usage":e.totalUsage,"daily-cost":e.dailyCost,"line-items":e.lineItems,"projected-charges":e.projectedCharges,mode:e.mode,expanded:!0,onEnterReading:a[9]||(a[9]=e=>i.value="enter"),onViewHistory:a[10]||(a[10]=e=>t.$emit("view-history"))},null,8,["meter-type","daily-usage","total-usage","daily-cost","line-items","projected-charges","mode"])])):(0,l.Q3)("",!0)])}}};var Vt=a(6939),Bt=a(7156);const Qt=(0,v.A)(Lt,[["__scopeId","data-v-574c145a"]]),$t=Qt;f()(Lt,"components",{QIcon:G.A,QBtnToggle:Vt.A,QInput:ie.A,QBtn:z.A,QField:Bt.A});a(9099),a(7033);const Dt={key:0,class:"flex flex-center q-pa-xl"},It={key:1,class:"q-pa-md"},Wt={key:2,class:"q-pa-md"},jt={class:"row items-center justify-between"},Tt={class:"text-subtitle1 text-weight-medium"},Xt={class:"text-caption text-grey-7"},Nt={key:0,class:"text-center q-pa-xl"},Kt={class:"bg-grey-2 q-pa-md",style:{overflow:"auto","max-height":"60vh"}},Mt={__name:"ReadingsEntryAdmin",setup(e){const t=(0,o.A)(),a=(0,i.useSiteStore)(),m=(0,s.useAccountStore)(),p=(0,d.useMeterStore)(),v=(0,u.useReadingStore)(),y=(0,r.KR)(!1),b=(0,r.KR)(null),f=(0,r.KR)(null),k=(0,r.KR)(new Date),w=(0,r.KR)(new Date(Date.now()+14688e5)),h=(0,r.KR)("10 Apr 2025"),_=(0,r.KR)("10 May 2025"),A=(0,r.KR)(!1),F=(0,r.KR)(!1),x=(0,r.KR)(!1),C=(0,r.KR)(!1),S=(0,r.KR)({id:null,value:"",reason:""}),q=(0,r.KR)(""),R=(0,r.KR)(null),E=(0,r.KR)({meter_id:null,value:"",date:(new Date).toISOString().split("T")[0],reason:"",is_rollover:!1}),L=(0,r.KR)(!1),V=(0,r.KR)(!1),B=(0,r.KR)(!1),Q=(0,r.KR)(""),$=(0,l.EW)(()=>{const e=[];return a.allSites.forEach(t=>{const a=m.getAccountsById(t.id);a.forEach(a=>{e.push({...a,siteName:t.address})})}),e}),D=(0,l.EW)(()=>$.value.map(e=>({id:e.id,label:`${e.number} - ${e.title} (${e.siteName})`}))),I=(0,l.EW)(()=>b.value?$.value.find(e=>e.id===b.value):null),W=(0,l.EW)(()=>b.value?p.getByAccuntId(b.value):[]),j=e=>1===e.type?.id?"water":"electricity",T=e=>{const t=v.getReadingsByMeterId(e);return t.map((e,t)=>({id:e.id,label:0===t?"Start Reading":"Reading",date:new Date(e.time),value:e.valueInString||e.value,type:e.isSubmit?"Final":"Estimated",canEdit:!0})).slice(0,5)},X=e=>{const t=v.getReadingsByMeterId(e);if(0===t.length)return 0;const a=t[0],l=Date.now()-a.time,r=864e5,n=r-l;return Math.max(0,Math.floor(n/1e3))},N=e=>"1290",K=e=>"33.90",M=e=>77.9,U=e=>[{label:"Consumption Charges",amount:1200},{label:"Discharge charges",amount:600},{label:"Infrastructure Surcharge",amount:200}],P=e=>3e3,G=async e=>{if(e){y.value=!0;try{await(0,c.fetchAndSaveMeterOnAccount)(e)}catch(e){t.notify({message:"Failed to load meters",color:"negative"})}finally{y.value=!1}}},O=e=>{t.notify({message:`Navigate ${e}`,color:"info"})},z=async e=>{f.value=e.meterId;try{t.notify({message:"Reading submitted (admin)",color:"positive"})}catch(e){t.notify({message:"Failed to submit reading",color:"negative"})}finally{f.value=null}},H=e=>{S.value={id:e.id,value:e.value,reason:""},A.value=!0},J=async()=>{if(S.value.reason){L.value=!0;try{const e=await g.editReading(S.value.id,{value:S.value.value,reason:S.value.reason});e.status?(t.notify({message:"Reading updated successfully",color:"positive"}),A.value=!1,b.value&&await(0,c.fetchAndSaveMeterOnAccount)(b.value)):t.notify({message:e.error||"Failed to update reading",color:"negative"})}catch(e){t.notify({message:"Failed to update reading: "+e.message,color:"negative"})}finally{L.value=!1}}else t.notify({message:"Please provide a reason for the edit",color:"warning"})},Z=e=>{t.notify({message:`View history for meter ${e.number}`,color:"info"})},Y=e=>{E.value={meter_id:e.id,value:"",date:(new Date).toISOString().split("T")[0],reason:"",is_rollover:!1},C.value=!0},ee=async()=>{if(E.value.reason)if(E.value.value){B.value=!0;try{const e=await g.addReading({meter_id:E.value.meter_id,meter_reading_date:E.value.date,meter_reading:E.value.value,reason:E.value.reason,is_rollover:E.value.is_rollover});e.status?(t.notify({message:"Reading added successfully",color:"positive"}),C.value=!1,b.value&&await(0,c.fetchAndSaveMeterOnAccount)(b.value)):t.notify({message:e.error||"Failed to add reading",color:"negative"})}catch(e){t.notify({message:"Failed to add reading: "+e.message,color:"negative"})}finally{B.value=!1}}else t.notify({message:"Please enter a reading value",color:"warning"});else t.notify({message:"Please provide a reason for adding",color:"warning"})},te=e=>{const t={id:e,value:"",reason:""};S.value=t,A.value=!0},ae=e=>{R.value=e,q.value="",F.value=!0},le=async()=>{if(q.value){V.value=!0;try{const e=await g.deleteReading(R.value,q.value);e.status?(t.notify({message:"Reading deleted successfully",color:"positive"}),F.value=!1,b.value&&await(0,c.fetchAndSaveMeterOnAccount)(b.value)):t.notify({message:e.error||"Failed to delete reading",color:"negative"})}catch(e){t.notify({message:"Failed to delete reading: "+e.message,color:"negative"})}finally{V.value=!1}}else t.notify({message:"Please provide a reason for deletion",color:"warning"})},re=async()=>{if(b.value){t.loading.show({message:"Recomputing bill..."});try{const e=await g.recomputeAccountBill(b.value,"Admin recompute request");e.status?(t.notify({message:"Bill recomputed successfully",color:"positive"}),await(0,c.fetchAndSaveMeterOnAccount)(b.value)):t.notify({message:e.error||"Failed to recompute bill",color:"negative"})}catch(e){t.notify({message:"Failed to recompute bill: "+e.message,color:"negative"})}finally{t.loading.hide()}}else t.notify({message:"Please select an account first",color:"warning"})},ne=e=>{Q.value=JSON.stringify({meter:e,readings:v.getReadingsByMeterId(e.id)},null,2),x.value=!0},oe=e=>{t.notify({message:`View audit log for meter ${e.number}`,color:"info"})},ie=e=>{t.notify({message:`Cooldown overridden for meter ${e.number}`,color:"deep-purple"})};return(0,l.sV)(()=>{D.value.length}),(e,t)=>{const a=(0,l.g2)("q-spinner"),o=(0,l.g2)("q-icon"),i=(0,l.g2)("q-select"),s=(0,l.g2)("q-card"),d=(0,l.g2)("q-btn"),u=(0,l.g2)("q-card-section"),c=(0,l.g2)("q-space"),m=(0,l.g2)("q-input"),p=(0,l.g2)("q-card-actions"),g=(0,l.g2)("q-dialog"),v=(0,l.g2)("q-checkbox"),R=(0,l.g2)("q-page"),$=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.Wv)(R,{class:"bg-grey-2"},{default:(0,l.k6)(()=>[(0,l.bF)((0,r.R1)(fe),{"current-date":k.value,"deadline-date":w.value,"period-start":h.value,"period-end":_.value,"show-total":!1,title:"ENTER READINGS",mode:"admin",onPrev:t[0]||(t[0]=e=>O("prev")),onNext:t[1]||(t[1]=e=>O("next"))},null,8,["current-date","deadline-date","period-start","period-end"]),y.value?((0,l.uX)(),(0,l.CE)("div",Dt,[(0,l.bF)(a,{color:"primary",size:"50px"})])):I.value?((0,l.uX)(),(0,l.CE)("div",Wt,[(0,l.bF)(s,{flat:"",bordered:"",class:"q-mb-md q-pa-sm"},{default:(0,l.k6)(()=>[(0,l.Lk)("div",jt,[(0,l.Lk)("div",null,[(0,l.Lk)("div",Tt,(0,n.v_)(I.value.number),1),(0,l.Lk)("div",Xt,(0,n.v_)(I.value.title),1)]),(0,l.bF)(d,{flat:"",dense:"",color:"primary",label:"Change Account",onClick:t[3]||(t[3]=e=>b.value=null)})])]),_:1}),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(W.value,e=>((0,l.uX)(),(0,l.CE)("div",{key:e.id,class:"q-mb-lg"},[(0,l.bF)(s,{flat:"",bordered:""},{default:(0,l.k6)(()=>[(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.bF)((0,r.R1)($t),{"meter-id":e.id,"meter-number":e.number,"meter-type":j(e),readings:T(e.id),"cooldown-seconds-remaining":X(e.id),"daily-usage":N(e.id),"total-usage":K(e.id),"daily-cost":M(e.id),"line-items":U(e.id),"projected-charges":P(e.id),submitting:f.value===e.id,mode:"admin",onSubmitReading:z,onEditReading:H,onViewHistory:t=>Z(e),onAdminAdd:t=>Y(e),onAdminEdit:te,onAdminDelete:ae,onAdminRecompute:re,onAdminViewJson:t=>ne(e),onAdminAuditLog:t=>oe(e),onCooldownOverride:t=>ie(e)},null,8,["meter-id","meter-number","meter-type","readings","cooldown-seconds-remaining","daily-usage","total-usage","daily-cost","line-items","projected-charges","submitting","onViewHistory","onAdminAdd","onAdminViewJson","onAdminAuditLog","onCooldownOverride"])]),_:2},1024)]),_:2},1024)]))),128)),0===W.value.length?((0,l.uX)(),(0,l.CE)("div",Nt,[(0,l.bF)(o,{name:"speed",size:"64px",color:"grey-5"}),t[17]||(t[17]=(0,l.Lk)("div",{class:"text-h6 q-mt-md text-grey-7"},"No meters found",-1)),t[18]||(t[18]=(0,l.Lk)("div",{class:"text-body2 text-grey-6"},"This account has no meters configured",-1))])):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("div",It,[(0,l.bF)(s,{flat:"",bordered:"",class:"q-pa-md text-center"},{default:(0,l.k6)(()=>[(0,l.bF)(o,{name:"account_circle",size:"64px",color:"grey-5"}),t[15]||(t[15]=(0,l.Lk)("div",{class:"text-h6 q-mt-md"},"Select an Account",-1)),t[16]||(t[16]=(0,l.Lk)("div",{class:"text-body2 text-grey-7 q-mb-md"}," Choose an account to view and manage readings ",-1)),(0,l.bF)(i,{modelValue:b.value,"onUpdate:modelValue":[t[2]||(t[2]=e=>b.value=e),G],options:D.value,"option-value":"id","option-label":"label",label:"Select Account",outlined:"","emit-value":"","map-options":"",class:"q-mb-md",style:{"max-width":"400px",margin:"0 auto"}},null,8,["modelValue","options"])]),_:1})])),(0,l.bF)(g,{modelValue:A.value,"onUpdate:modelValue":t[6]||(t[6]=e=>A.value=e),persistent:""},{default:(0,l.k6)(()=>[(0,l.bF)(s,{style:{"min-width":"350px"}},{default:(0,l.k6)(()=>[(0,l.bF)(u,{class:"row items-center"},{default:(0,l.k6)(()=>[t[19]||(t[19]=(0,l.Lk)("div",{class:"text-h6"},"Edit Reading",-1)),(0,l.bF)(c),(0,l.bo)((0,l.bF)(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[$]])]),_:1}),(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.bF)(m,{modelValue:S.value.value,"onUpdate:modelValue":t[4]||(t[4]=e=>S.value.value=e),label:"Reading Value",type:"number",outlined:"",class:"q-mb-md"},null,8,["modelValue"]),(0,l.bF)(m,{modelValue:S.value.reason,"onUpdate:modelValue":t[5]||(t[5]=e=>S.value.reason=e),label:"Reason for Edit",type:"textarea",outlined:"",hint:"Required for audit trail"},null,8,["modelValue"])]),_:1}),(0,l.bF)(p,{align:"right"},{default:(0,l.k6)(()=>[(0,l.bo)((0,l.bF)(d,{flat:"",label:"Cancel"},null,512),[[$]]),(0,l.bF)(d,{color:"primary",label:"Save",loading:L.value,onClick:J},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(g,{modelValue:F.value,"onUpdate:modelValue":t[8]||(t[8]=e=>F.value=e),persistent:""},{default:(0,l.k6)(()=>[(0,l.bF)(s,{style:{"min-width":"350px"}},{default:(0,l.k6)(()=>[(0,l.bF)(u,{class:"row items-center"},{default:(0,l.k6)(()=>[(0,l.bF)(o,{name:"warning",color:"negative",size:"md",class:"q-mr-sm"}),t[20]||(t[20]=(0,l.Lk)("div",{class:"text-h6"},"Delete Reading",-1))]),_:1}),(0,l.bF)(u,null,{default:(0,l.k6)(()=>[t[21]||(t[21]=(0,l.Lk)("div",{class:"text-body1 q-mb-md"}," Are you sure you want to delete this reading? This action will be logged. ",-1)),(0,l.bF)(m,{modelValue:q.value,"onUpdate:modelValue":t[7]||(t[7]=e=>q.value=e),label:"Reason for Deletion",type:"textarea",outlined:"",hint:"Required for audit trail"},null,8,["modelValue"])]),_:1}),(0,l.bF)(p,{align:"right"},{default:(0,l.k6)(()=>[(0,l.bo)((0,l.bF)(d,{flat:"",label:"Cancel"},null,512),[[$]]),(0,l.bF)(d,{color:"negative",label:"Delete",loading:V.value,onClick:le},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(g,{modelValue:x.value,"onUpdate:modelValue":t[9]||(t[9]=e=>x.value=e),"full-width":""},{default:(0,l.k6)(()=>[(0,l.bF)(s,null,{default:(0,l.k6)(()=>[(0,l.bF)(u,{class:"row items-center"},{default:(0,l.k6)(()=>[t[22]||(t[22]=(0,l.Lk)("div",{class:"text-h6"},"Raw JSON Data",-1)),(0,l.bF)(c),(0,l.bo)((0,l.bF)(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[$]])]),_:1}),(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.Lk)("pre",Kt,(0,n.v_)(Q.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,l.bF)(g,{modelValue:C.value,"onUpdate:modelValue":t[14]||(t[14]=e=>C.value=e),persistent:""},{default:(0,l.k6)(()=>[(0,l.bF)(s,{style:{"min-width":"400px"}},{default:(0,l.k6)(()=>[(0,l.bF)(u,{class:"row items-center"},{default:(0,l.k6)(()=>[t[23]||(t[23]=(0,l.Lk)("div",{class:"text-h6"},"Add New Reading (Admin)",-1)),(0,l.bF)(c),(0,l.bo)((0,l.bF)(d,{icon:"close",flat:"",round:"",dense:""},null,512),[[$]])]),_:1}),(0,l.bF)(u,null,{default:(0,l.k6)(()=>[(0,l.bF)(m,{modelValue:E.value.value,"onUpdate:modelValue":t[10]||(t[10]=e=>E.value.value=e),label:"Reading Value",type:"text",outlined:"",class:"q-mb-md",hint:"Enter the meter reading value"},null,8,["modelValue"]),(0,l.bF)(m,{modelValue:E.value.date,"onUpdate:modelValue":t[11]||(t[11]=e=>E.value.date=e),label:"Reading Date",type:"date",outlined:"",class:"q-mb-md"},null,8,["modelValue"]),(0,l.bF)(v,{modelValue:E.value.is_rollover,"onUpdate:modelValue":t[12]||(t[12]=e=>E.value.is_rollover=e),label:"Mark as rollover reading",class:"q-mb-md"},null,8,["modelValue"]),(0,l.bF)(m,{modelValue:E.value.reason,"onUpdate:modelValue":t[13]||(t[13]=e=>E.value.reason=e),label:"Reason for Adding",type:"textarea",outlined:"",hint:"Required for audit trail"},null,8,["modelValue"])]),_:1}),(0,l.bF)(p,{align:"right"},{default:(0,l.k6)(()=>[(0,l.bo)((0,l.bF)(d,{flat:"",label:"Cancel"},null,512),[[$]]),(0,l.bF)(d,{color:"primary",label:"Add Reading",loading:B.value,onClick:ee},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};var Ut=a(7716),Pt=a(564),Gt=a(1033),Ot=a(460),zt=a(8672);const Ht=Mt,Jt=Ht;f()(Mt,"components",{QPage:Ut.A,QSpinner:Pt.A,QCard:M.A,QIcon:G.A,QSelect:Gt.A,QBtn:z.A,QCardSection:U.A,QDialog:re.A,QSpace:ut.A,QInput:ie.A,QCardActions:ne.A,QCheckbox:Ot.A}),f()(Mt,"directives",{ClosePopup:zt.A})}}]);